---

---

<script>
  import gsap from "gsap";
  import ScrollTrigger from "gsap/dist/ScrollTrigger";
  gsap.registerPlugin(ScrollTrigger);

  PinStepBlock();

  //Bloc Text Image
  function PinStepBlock() {
    const PinStepBlockElems = document.querySelectorAll(".PinStepBlock");
    PinStepBlockElems?.forEach((PinStepBlock) => {
      const contenuDroitElem = document.querySelector(".contenuTexteColD");

      // Calcul des distances manuellement
      const contenuDroitRect = contenuDroitElem.getBoundingClientRect();
      const windowCenter = window.innerHeight / 2;
      const ElementDistanceStart = Math.abs(
        contenuDroitRect.top + contenuDroitRect.height / 2 - windowCenter,
      );
      const ElementDistanceEnd = Math.abs(
        contenuDroitRect.bottom - windowCenter,
      );
      const Distance = {
        Pixels: function (axis) {
          return axis === "Y" ? ElementDistanceStart : 0;
        },
      };

      const imagesElems = document.querySelectorAll(
        ".contenuTexteColD .pinDiv",
      );
      imagesElems.forEach((image, index) => {
        const tl = gsap.timeline({
          scrollTrigger: {
            markers: false,
            start: "center center",
            end: `+=${ElementDistanceEnd - image.clientHeight}px center`,
            trigger: image,
            pin: true,
            scrub: true,
          },
        });
      });

      const textsElems = PinStepBlock.querySelectorAll(
        ".contenuTexteColG .blocTxt",
      );
      textsElems?.forEach((textElem, index) => {
        const tl = gsap.timeline({
          scrollTrigger: {
            markers: false,
            start: "top 80%",
            end: "top 80%",
            onEnter: () => {
              const img =
                imagesElems.length > index - 1 ? imagesElems[index - 1] : null;
              if (img) {
                gsap.to(img, {
                  opacity: 0,
                });
              }

              const nextImg =
                imagesElems.length > index ? imagesElems[index] : null;
              if (nextImg) {
                gsap.to(nextImg, {
                  opacity: 1,
                });
              }

              const bullet =
                bullets.length > index - 1 ? bullets[index - 1] : null;
              if (bullet) {
                gsap.to(bullet, {
                  scale: 1,
                });
              }
              const nextbullet = bullets.length > index ? bullets[index] : null;
              if (nextbullet) {
                gsap.to(nextbullet, {
                  scale: 2,
                });
              }
            },
            onEnterBack: () => {
              const img =
                imagesElems.length > index - 1 ? imagesElems[index - 1] : null;
              if (img) {
                gsap.to(img, {
                  opacity: 1,
                });
              }
              const nextImg =
                imagesElems.length > index ? imagesElems[index] : null;
              if (nextImg && index != 0) {
                gsap.to(nextImg, {
                  opacity: 0,
                });
              }

              const bullet =
                bullets.length > index - 1 ? bullets[index - 1] : null;
              if (bullet) {
                gsap.to(bullet, {
                  scale: 1.3,
                });
              }
              const nextbullet = bullets.length > index ? bullets[index] : null;
              if (nextbullet && index != 0) {
                gsap.to(nextbullet, {
                  scale: 1,
                });
              }
            },
            trigger: textElem,
          },
        });
      });

      const img = imagesElems.length > 0 ? imagesElems[0] : null;
      if (img) {
        gsap.to(img, {
          opacity: 1,
        });
      }

      const bullets = getBullets();

      function getBullets() {
        const bullets = [];

        const parent = document.createElement("div");
        parent.classList.add("bulletsListTxtImg");

        textsElems?.forEach((text) => {
          const bullet = document.createElement("span");
          bullet.classList.add("bullet");
          parent.appendChild(bullet);
          bullets.push(bullet);
        });
        PinStepBlock.insertBefore(parent, PinStepBlock.firstChild);

        return bullets;
      }
    });
  }
</script>

<section class="PinStepBlock">
  <div class="bulletsListTxtImg">
      <span class="bullet"></span>
      <span class="bullet"></span>
      <span class="bullet"></span>
  </div>
  <div class="contenuTexteColG">
    <div class="blocTxt">
      <div class="content">
        <h2>Test</h2>
      </div>
    </div>
    <div class="blocTxt">
      <div class="content">
        <h2>Test</h2>
      </div>
    </div>
    <div class="blocTxt">
      <div class="content">
        <h2>Test</h2>
      </div>
    </div>
  </div>
  <div class="contenuTexteColD">
    <div class="pin-spacer">
      <div class="pinDiv">
        <img src="/assets/images/landingpage.jpg" />
      </div>
    </div>
    <div class="pin-spacer">
      <div class="pinDiv">
        <img src="/assets/images/maintenance.jpg" />
      </div>
    </div>
    <div class="pin-spacer">
      <div class="pinDiv">
        <img src="/assets/images/silvianna-project.jpg" />
      </div>
    </div>
  </div>
</section>
